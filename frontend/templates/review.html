<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Submit Review</title>

    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css"
    />
    <link rel="stylesheet" href="assets/style.css" />

    <style>
      .rating-group {
        display: flex;
        justify-content: center;
        gap: 15px;
      }

      .rating-circle {
        width: 45px;
        height: 45px;
        border-radius: 50%;
        border: 2px solid #ccc;
        display: flex;
        justify-content: center;
        align-items: center;
        cursor: pointer;
        font-weight: 500;
        color: #555;
        transition: all 0.2s ease-in-out;
      }

      .rating-input {
        display: none;
      }

      .rating-group .rating-circle:hover {
        border-color: #555;
        background-color: #f1f1f1;
      }

      .rating-input:checked + .rating-circle {
        background-color: #257a24;
        color: #fff;
      }
    </style>
  </head>

  <body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
      <a class="navbar-brand" href="index.html">ECE 46100</a>
      <button
        class="navbar-toggler"
        type="button"
        data-toggle="collapse"
        data-target="#navbarNav"
        aria-controls="navbarNav"
        aria-expanded="false"
        aria-label="Toggle navigation"
      >
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link" href="index.html">Home</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="browse.html">AI Database</a>
          </li>
          <li class="nav-item dropdown">
            <a
              class="nav-link dropdown-toggle"
              href="#"
              id="reviewsDropdown"
              role="button"
              data-toggle="dropdown"
              aria-haspopup="true"
              aria-expanded="false"
            >
              Reviews
            </a>
            <div class="dropdown-menu" aria-labelledby="reviewsDropdown">
              <a class="dropdown-item" href="review.html">Submit Review</a>
              <a class="dropdown-item" href="modelReviews.html">Model Reviews</a>
              <a class="dropdown-item" href="thank.html">Help us Improve</a>
            </div>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="login.html">Profile</a>
          </li>
        </ul>
      </div>
    </nav>

    <div class="container mt-5">
      <div class="card shadow-sm p-4">
        <h3 class="mb-4">Help us improve the AI Database</h3>

        <form id="reviewForm">
          <!-- Each rating section -->
          <div class="mb-4">
            <label class="form-label d-block">How was the ramp up time?</label>
            <div
              class="d-flex align-items-center justify-content-center"
              style="gap: 20px"
            >
              <span
                class="text-muted small"
                style="min-width: 80px; text-align: right"
                >Very Difficult</span
              >
              <div class="rating-group" id="ramp-group"></div>
              <span class="text-muted small" style="min-width: 80px"
                >Very Easy</span
              >
            </div>
          </div>

          <div class="mb-4">
            <label class="form-label d-block"
              >How resilient is the project team (Bus Factor)?</label
            >
            <div
              class="d-flex align-items-center justify-content-center"
              style="gap: 20px"
            >
              <span
                class="text-muted small"
                style="min-width: 80px; text-align: right"
                >Low Resilience</span
              >
              <div class="rating-group" id="bus-group"></div>
              <span class="text-muted small" style="min-width: 80px"
                >High Resilience</span
              >
            </div>
          </div>

          <div class="mb-4">
            <label class="form-label d-block"
              >How clear was the license compatibility?</label
            >
            <div
              class="d-flex align-items-center justify-content-center"
              style="gap: 20px"
            >
              <span
                class="text-muted small"
                style="min-width: 80px; text-align: right"
                >Unclear</span
              >
              <div class="rating-group" id="license-group"></div>
              <span class="text-muted small" style="min-width: 80px"
                >Very Clear</span
              >
            </div>
          </div>

          <div class="mb-4">
            <label class="form-label d-block"
              >How would you rate size & portability?</label
            >
            <div
              class="d-flex align-items-center justify-content-center"
              style="gap: 20px"
            >
              <span
                class="text-muted small"
                style="min-width: 80px; text-align: right"
                >Too Large</span
              >
              <div class="rating-group" id="size-group"></div>
              <span class="text-muted small" style="min-width: 80px"
                >Compact</span
              >
            </div>
          </div>

          <div class="mb-4">
            <label class="form-label d-block"
              >How would you rate dataset quality?</label
            >
            <div
              class="d-flex align-items-center justify-content-center"
              style="gap: 20px"
            >
              <span
                class="text-muted small"
                style="min-width: 80px; text-align: right"
                >Poor</span
              >
              <div class="rating-group" id="data-group"></div>
              <span class="text-muted small" style="min-width: 80px"
                >Excellent</span
              >
            </div>
          </div>

          <div class="mb-4">
            <label class="form-label d-block"
              >How would you rate code quality?</label
            >
            <div
              class="d-flex align-items-center justify-content-center"
              style="gap: 20px"
            >
              <span
                class="text-muted small"
                style="min-width: 80px; text-align: right"
                >Low</span
              >
              <div class="rating-group" id="code-group"></div>
              <span class="text-muted small" style="min-width: 80px">High</span>
            </div>
          </div>

          <!-- Comments -->
          <div class="mb-4">
            <label for="comments" class="form-label"
              >Can you tell us more?</label
            >
            <textarea
              class="form-control"
              id="comments"
              rows="3"
              placeholder="Your feedback..."
            ></textarea>
          </div>

          <!-- Buttons -->
          <div class="d-flex justify-content-end">
            <a href="index.html" class="btn btn-outline-secondary mr-2"
              >Cancel</a
            >
            <button type="submit" class="btn btn-dark">Submit Review</button>
          </div>
        </form>
      </div>
    </div>

    <script
      src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
      integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js"
      integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js"
      integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
      crossorigin="anonymous"
    ></script>
    <script>
      // Utility: generate rating circles dynamically
      function createRatingGroup(id, name) {
        const container = document.getElementById(id);
        for (let i = 1; i <= 10; i++) {
          const input = document.createElement("input");
          input.type = "radio";
          input.name = name;
          input.value = i;
          input.id = `${name}_${i}`;
          input.className = "rating-input";
          input.required = true;

          const label = document.createElement("label");
          label.htmlFor = input.id;
          label.className = "rating-circle";
          label.textContent = i;

          container.appendChild(input);
          container.appendChild(label);
        }
      }

      ["ramp", "bus", "license", "size", "data", "code"].forEach((field) =>
        createRatingGroup(`${field}-group`, field)
      );

      // Submit handler
      document
        .getElementById("reviewForm")
        .addEventListener("submit", async (e) => {
          e.preventDefault();

          const payload = {
            ramp: document.querySelector('input[name="ramp"]:checked')?.value,
            bus: document.querySelector('input[name="bus"]:checked')?.value,
            license: document.querySelector('input[name="license"]:checked')
              ?.value,
            size: document.querySelector('input[name="size"]:checked')?.value,
            data: document.querySelector('input[name="data"]:checked')?.value,
            code: document.querySelector('input[name="code"]:checked')?.value,
            comments: document.getElementById("comments").value.trim(),
          };

          try {
            const res = await fetch(
              "https://sm90vexhij.execute-api.us-east-2.amazonaws.com/Initial/review",
              {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(payload),
              }
            );

            const result = await res.json();
            console.log("Review submitted:", result);

            if (res.ok) {
              window.location.href = "thank.html";
            } else {
              alert(
                "Submission failed: " + (result.message || "Unknown error")
              );
            }
          } catch (err) {
            console.error("Network error:", err);
            alert("Error submitting review. Please try again later.");
          }
        });
    </script>
  </body>
</html>
